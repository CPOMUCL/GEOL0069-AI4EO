

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Data Fetching &#8212; GEOL0069 Guide Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Chapter 1:Fetching_Data';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Roll-out on a Full Image" href="Chapter_1_rollout_3.html" />
    <link rel="prev" title="AI/Machine Learning Implementation" href="Chapter_1_AI_Algorithms.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to GEOL0069 AI for Earth Observation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3APreparation.html">Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3AIRIS.html">Introduction to Intelligently Reinforced Image Segmentation (IRIS)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3AML.html">Introduction to AI/Machine Learning</a></li>

<li class="toctree-l1"><a class="reference internal" href="Chapter_1_Sea_ice_and_Lead_Classification.html">Sea-ice and Lead Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_1_AI_Algorithms.html">AI/Machine Learning Implementation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Data Fetching</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_1_rollout_3.html">Roll-out on a Full Image</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Data_Colocating_S2_S3_3.html">Colocating Sentinel-3 OLCI/SRAL and Sentinal-2 Optical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Unsupervised_Learning_Methods_2.html">Unsupervised Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Regression.html">Regression Techniques for Predictive Analysis</a></li>

<li class="toctree-l1"><a class="reference internal" href="Creating_training_data_fromS3_S2.html">Creating Training Data from Sentinel-2 and Sentinel-3 OLCI Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Regression_Part2_2425.html">Application of Regression Techniques in Satellite Imagery Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter1%3AColocating_data.html">Colocate Sentinel-2 and Sentinel-3 Imagery</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter1%3ARegression_Part2.html">Application of Regression Techniques in Satellite Imagery Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="References1.html">References</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter2_IntrotoGaussianProcesses.html">Introduction to Gaussian Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_2_Intro_to_GPSat.html">Introduction to GPSat</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 8</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter_2_SLA_GPSat_William.html">Interpolation of Sea Level Anomaly using GPSat</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_2_GPSat_along_track-2.html">Along track interpolation</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 9</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExplainableAI.html">Explainable AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExplainableAI_Part2.html">Explainable AI Part 2</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FChapter 1:Fetching_Data.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Chapter 1:Fetching_Data.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Data Fetching</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copernicus-data-space">Copernicus Data Space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-accounts">Set up Accounts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-fetching-logic">Data Fetching Logic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-0-set-up">Step 0: Set Up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-read-in-functions-needed">Step 1: Read in Functions Needed</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-extract-metadata-from-copernicus-dataspace">Step 2: Extract Metadata from Copernicus Dataspace</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-download">Step 4: Download</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-downloading-option-download-directly-from-one-file-with-know-filename-you-are-interested-in">Another downloading option: Download directly from one file (with know filename) you are interested in</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="data-fetching">
<h1>Data Fetching<a class="headerlink" href="#data-fetching" title="Permalink to this heading">#</a></h1>
<p>ðŸ“˜ <strong>Interactive Version</strong>: For a hands-on experience with this chapterâ€™s content, access the interactive notebook in <a class="reference external" href="https://drive.google.com/file/d/1pErEpx7pmNjnme-E9yw4oAopr-VnW3aO/view?usp=sharing">Google Colab</a>. Week 3 materials can be found <a class="reference external" href="https://drive.google.com/drive/folders/1kHoYPHStNVjJNAlJGBmLX1aE6ZlYL3rH?usp=share_link">here</a>.
In this section, we will delve into the process of acquiring the dataset that has been integral to our analyses â€“ the OLCI data from the Sentinel-3 satellite, part of the Copernicus Dataspace. This segment will guide you through the nuances of accessing this rich dataset, understanding its structure, and efficiently retrieving the data you need for your work.</p>
<section id="copernicus-data-space">
<h2>Copernicus Data Space<a class="headerlink" href="#copernicus-data-space" title="Permalink to this heading">#</a></h2>
<p><strong>Overview</strong><br />
Copernicus Data Space is a cornerstone of the European Unionâ€™s Earth observation program, providing a wealth of data from the Sentinel satellites. Aimed at monitoring the Earthâ€™s environment, it supports applications in areas like climate change, disaster response, and urban planning.</p>
<p><strong>Key Features</strong></p>
<ul class="simple">
<li><p><strong>Diverse Datasets</strong>: Offers imagery, atmospheric measurements, and climate indicators.</p></li>
<li><p><strong>Accessibility</strong>: Data is freely accessible, fostering open science and research.</p></li>
</ul>
<p><strong>Resources</strong><br />
For more information and data access, visit the <a class="reference external" href="https://dataspace.copernicus.eu">Copernicus Dataspace</a>.</p>
</section>
<hr class="docutils" />
<section id="set-up-accounts">
<h2>Set up Accounts<a class="headerlink" href="#set-up-accounts" title="Permalink to this heading">#</a></h2>
<p>Before delving into the specifics of data retrieval, itâ€™s crucial to ensure you have access to the necessary platforms.</p>
<p><strong>Copernicus Dataspace:</strong> Accessing data from the Copernicus Dataspace requires a separate registration. If you havenâ€™t done so, please take a moment to create an account. Simply visit the <a class="reference external" href="https://dataspace.copernicus.eu">Copernicus Dataspace registration page</a> and follow the instructions to sign up.</p>
</section>
<section id="data-fetching-logic">
<h2>Data Fetching Logic<a class="headerlink" href="#data-fetching-logic" title="Permalink to this heading">#</a></h2>
<p>The logic underlying the data fetching process involves several key steps:</p>
<ol class="arabic simple">
<li><p><strong>Area and Time Specification:</strong> Initially, we define the geographical scope and the specific time frame of interest. This precise specification allows us to target our data retrieval effectively.</p></li>
<li><p><strong>Retrieving Metadata from Copernicus Dataspace:</strong> Once the area and time parameters are set, we proceed to fetch a list of relevant file names from Copernicus Dataspace.</p></li>
<li><p><strong>Optional 1: Fetching Raw Data from Copernicus Dataspace given date and time:</strong> With the metadata saved, we then access the Copernicus Dataspace to retrieve the raw data. You are able to see its preview at <a class="reference external" href="https://browser.dataspace.copernicus.eu/">Copernicus Dataspace browser</a> with filename you are interested in (to see if it is cloud free, etc), before initiating the download.</p></li>
<li><p><strong>Optional 2: Browsing first and download the raw data:</strong>  You can also go to the <a class="reference external" href="https://browser.dataspace.copernicus.eu/">Copernicus Dataspace browser</a> first and select you images. With filenames you are interested, you can initiate the download.</p></li>
</ol>
<section id="step-0-set-up">
<h3>Step 0: Set Up<a class="headerlink" href="#step-0-set-up" title="Permalink to this heading">#</a></h3>
<p>Before we dive into the data fetching process, itâ€™s essential to lay the groundwork by setting up the necessary packages and ensuring proper authentication. Follow these preparatory steps to create a smooth and efficient workflow:
<strong>Install Required Packages:</strong> Make sure all the necessary packages are installed in your working environment. This includes libraries specific to data handling, geospatial analysis, and any other tools relevant to your project. On Google Colab you donâ€™t need to do this, but this is a commpn practice when you exceute the code on your local machine.</p>
<p>By completing these initial setup step, youâ€™re ensuring that your environment is ready and equipped with the tools needed for data fetching and analysis.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span><span class="p">,</span> <span class="n">Point</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">requests</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span> <span class="k">as</span> <span class="n">ET</span>
<span class="kn">from</span> <span class="nn">shapely.geometry</span> <span class="kn">import</span> <span class="n">Polygon</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>
</div>
</div>
</div>
<p>Remember to replace â€˜project_idâ€™ with your actual project id.</p>
</section>
<section id="step-1-read-in-functions-needed">
<h3>Step 1: Read in Functions Needed<a class="headerlink" href="#step-1-read-in-functions-needed" title="Permalink to this heading">#</a></h3>
<p>To streamline our data fetching and processing, weâ€™ll first load the essential functions. These functions are designed to handle various tasks such as data retrieval, format conversion, and preliminary data processing. Ensure that youâ€™ve imported all the required functions before proceeding to the next steps of the workflow. All functions have docstrings so please read them to get some ideas of what they do.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_api_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;GET&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="k">global</span> <span class="n">access_token</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">headers</span><span class="p">:</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">401</span><span class="p">,</span> <span class="mi">403</span><span class="p">]:</span>
        <span class="k">global</span> <span class="n">refresh_token</span>
        <span class="n">access_token</span> <span class="o">=</span> <span class="n">refresh_access_token</span><span class="p">(</span><span class="n">refresh_token</span><span class="p">)</span>
        <span class="n">headers</span><span class="p">[</span><span class="s2">&quot;Authorization&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span><span class="n">method</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">response</span>


<span class="k">def</span> <span class="nf">query_sentinel3_olci_arctic_data</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Queries Sentinel-3 OLCI data within a specified time range from the Copernicus Data Space,</span>
<span class="sd">    targeting data collected over the Arctic region.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    start_date (str): Start date in &#39;YYYY-MM-DD&#39; format.</span>
<span class="sd">    end_date (str): End date in &#39;YYYY-MM-DD&#39; format.</span>
<span class="sd">    token (str): Access token for authentication.</span>

<span class="sd">    Returns:</span>
<span class="sd">    DataFrame: Contains details about the Sentinel-3 OLCI images.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="c1"># arctic_polygon = &quot;POLYGON((-180 60, 180 60, 180 90, -180 90, -180 60))&quot;</span>
    <span class="n">arctic_polygon</span> <span class="o">=</span> <span class="p">(</span>
        <span class="s2">&quot;POLYGON ((-81.7 71.7, -81.7 73.8, -75.1 73.8, -75.1 71.7, -81.7 71.7))&quot;</span>
    <span class="p">)</span>

    <span class="n">filter_string</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Collection/Name eq &#39;SENTINEL-3&#39; and &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;Attributes/OData.CSC.StringAttribute/any(att:att/Name eq &#39;productType&#39; and att/Value eq &#39;OL_1_EFR___&#39;) and &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;ContentDate/Start gt </span><span class="si">{</span><span class="n">start_date</span><span class="si">}</span><span class="s2">T00:00:00.000Z and ContentDate/Start lt </span><span class="si">{</span><span class="n">end_date</span><span class="si">}</span><span class="s2">T23:59:59.999Z&quot;</span>
    <span class="p">)</span>

    <span class="n">next_url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://catalogue.dataspace.copernicus.eu/odata/v1/Products?&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;$filter=</span><span class="si">{</span><span class="n">filter_string</span><span class="si">}</span><span class="s2"> and &quot;</span>
        <span class="sa">f</span><span class="s2">&quot;OData.CSC.Intersects(area=geography&#39;SRID=4326;</span><span class="si">{</span><span class="n">arctic_polygon</span><span class="si">}</span><span class="s2">&#39;)&amp;&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;$top=1000&quot;</span>
    <span class="p">)</span>

    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>

    <span class="k">while</span> <span class="n">next_url</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">make_api_request</span><span class="p">(</span><span class="n">next_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;value&quot;</span><span class="p">]</span>
            <span class="n">all_data</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="n">next_url</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;@odata.nextLink&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching data: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">break</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">all_data</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">get_access_and_refresh_token</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Retrieve both access and refresh tokens.&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
        <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="n">username</span><span class="p">,</span>
        <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="n">password</span><span class="p">,</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;cdse-public&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
    <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
    <span class="n">tokens</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">tokens</span><span class="p">[</span><span class="s2">&quot;access_token&quot;</span><span class="p">],</span> <span class="n">tokens</span><span class="p">[</span><span class="s2">&quot;refresh_token&quot;</span><span class="p">]</span>


<span class="k">def</span> <span class="nf">refresh_access_token</span><span class="p">(</span><span class="n">refresh_token</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Attempt to refresh the access token using the refresh token.&quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://identity.dataspace.copernicus.eu/auth/realms/CDSE/protocol/openid-connect/token&quot;</span>
    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;refresh_token&quot;</span><span class="p">,</span>
        <span class="s2">&quot;refresh_token&quot;</span><span class="p">:</span> <span class="n">refresh_token</span><span class="p">,</span>
        <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="s2">&quot;cdse-public&quot;</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/x-www-form-urlencoded&quot;</span><span class="p">}</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>  <span class="c1"># This will throw an error for non-2xx responses</span>
        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&quot;access_token&quot;</span><span class="p">]</span>
    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">exceptions</span><span class="o">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to refresh token: </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">e</span><span class="o">.</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">400</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Refresh token invalid, attempting re-authentication...&quot;</span><span class="p">)</span>
            <span class="c1"># Attempt to re-authenticate</span>
            <span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
            <span class="n">password</span> <span class="o">=</span> <span class="n">password</span>
            <span class="c1"># This requires securely managing the credentials, which might not be feasible in all contexts</span>
            <span class="n">access_token</span><span class="p">,</span> <span class="n">new_refresh_token</span> <span class="o">=</span> <span class="n">get_access_and_refresh_token</span><span class="p">(</span>
                <span class="n">username</span><span class="p">,</span> <span class="n">password</span>
            <span class="p">)</span>  <span class="c1"># This is a placeholder</span>
            <span class="n">refresh_token</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">new_refresh_token</span>  <span class="c1"># Update the global refresh token with the new one</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">access_token</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span>

<span class="k">def</span> <span class="nf">download_single_product</span><span class="p">(</span>
    <span class="n">product_id</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">download_dir</span><span class="o">=</span><span class="s2">&quot;downloaded_products&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Download a single product from the Copernicus Data Space.</span>

<span class="sd">    :param product_id: The unique identifier for the product.</span>
<span class="sd">    :param file_name: The name of the file to be downloaded.</span>
<span class="sd">    :param access_token: The access token for authorization.</span>
<span class="sd">    :param download_dir: The directory where the product will be saved.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Ensure the download directory exists</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Construct the download URL</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://zipper.dataspace.copernicus.eu/odata/v1/Products(</span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">)/$value&quot;</span>
    <span class="p">)</span>

    <span class="c1"># Set up the session and headers</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">access_token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    <span class="n">session</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">Session</span><span class="p">()</span>
    <span class="n">session</span><span class="o">.</span><span class="n">headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">headers</span><span class="p">)</span>

    <span class="c1"># Perform the request</span>
    <span class="n">response</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Check if the request was successful</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="c1"># Define the path for the output file</span>
        <span class="n">output_file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">download_dir</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">+</span> <span class="s2">&quot;.zip&quot;</span><span class="p">)</span>

        <span class="c1"># Stream the content to a file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">output_file_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">chunk</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">iter_content</span><span class="p">(</span><span class="n">chunk_size</span><span class="o">=</span><span class="mi">8192</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">chunk</span><span class="p">:</span>
                    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Downloaded: </span><span class="si">{</span><span class="n">output_file_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Failed to download product </span><span class="si">{</span><span class="n">product_id</span><span class="si">}</span><span class="s2">. Status Code: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="step-2-extract-metadata-from-copernicus-dataspace">
<h3>Step 2: Extract Metadata from Copernicus Dataspace<a class="headerlink" href="#step-2-extract-metadata-from-copernicus-dataspace" title="Permalink to this heading">#</a></h3>
<p>Once you have set up your environment and are authenticated with Copernicus Dataspace, the next step is to extract the filenames that meet your specific criteria.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;your_username&quot;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;your_password&quot;</span>
<span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">get_access_and_refresh_token</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
<span class="n">start_date</span> <span class="o">=</span> <span class="s2">&quot;2018-06-01&quot;</span>
<span class="n">end_date</span> <span class="o">=</span> <span class="s2">&quot;2018-06-02&quot;</span>

<span class="n">sentinel3_olci_data</span> <span class="o">=</span> <span class="n">query_sentinel3_olci_arctic_data</span><span class="p">(</span>
    <span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">access_token</span>
<span class="p">)</span>

<span class="c1"># You can also save the metadata</span>
<span class="c1"># sentinel3_olci_data.to_csv(</span>
<span class="c1">#     &quot;/home/wch/data_colocation/Datasets-Co-location/Metadata/sentinel3_olci_metadata_2018_zara.csv&quot;,</span>
<span class="c1">#     index=False,</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
</div>
<p>Below you can print the metadata you have just retrieved, it contains several aspects of S3 OLCI including: filename, Id, geo footprint and sensing data, etc.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>

<span class="n">display</span><span class="p">(</span><span class="n">sentinel3_olci_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>@odata.mediaContentType</th>
      <th>Id</th>
      <th>Name</th>
      <th>ContentType</th>
      <th>ContentLength</th>
      <th>OriginDate</th>
      <th>PublicationDate</th>
      <th>ModificationDate</th>
      <th>Online</th>
      <th>EvictionDate</th>
      <th>S3Path</th>
      <th>Checksum</th>
      <th>ContentDate</th>
      <th>Footprint</th>
      <th>GeoFootprint</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>application/octet-stream</td>
      <td>f5d75e25-dcd6-533c-87f6-011d6de97462</td>
      <td>S3A_OL_1_EFR____20180601T032045_20180601T032125_20180602T084716_0040_032_004_1080_LN1_O_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2018-10-28T21:19:59.653000Z</td>
      <td>2018-06-02T12:33:14.692000Z</td>
      <td>2018-06-02T12:33:14.692000Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/01/S3A_OL_1_EFR____20180601T032045_20180601T032125_2018...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-01T03:20:44.670886Z', 'End': '2018-06-01T03:21:24.842161Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-78.5521 74.8857, -80.9457 74.8563, -83.2831 74.8023, -85.6253 74....</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-78.5521, 74.8857], [-80.9457, 74.8563], [-83.2831, 74.802...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>application/octet-stream</td>
      <td>9d2e570a-8504-5947-8c73-6feda1a5b80a</td>
      <td>S3A_OL_1_EFR____20180601T014026_20180601T014326_20180602T052347_0179_032_003_1260_LN1_O_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2018-11-01T17:54:38.378000Z</td>
      <td>2018-06-02T08:57:02.432000Z</td>
      <td>2018-06-02T08:57:02.432000Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/01/S3A_OL_1_EFR____20180601T014026_20180601T014326_2018...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-01T01:40:25.621348Z', 'End': '2018-06-01T01:43:25.621348Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-53.4973 85.3067, -61.0276 85.2807, -68.3596 85.1745, -75.297 84.9...</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-53.4973, 85.3067], [-61.0276, 85.2807], [-68.3596, 85.174...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>application/octet-stream</td>
      <td>f0e338e0-6e3e-5cd6-b38c-2fd51dab2da7</td>
      <td>S3A_OL_1_EFR____20180601T151419_20180601T151719_20180602T202519_0179_032_011_1620_LN1_O_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2018-11-01T18:21:27.991000Z</td>
      <td>2018-06-02T23:53:37.479000Z</td>
      <td>2018-06-02T23:53:37.479000Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/01/S3A_OL_1_EFR____20180601T151419_20180601T151719_2018...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-01T15:14:19.387665Z', 'End': '2018-06-01T15:17:19.387665Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-81.12 73.846, -78.9112 73.8144, -76.7017 73.7603, -74.5009 73.683...</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-81.12, 73.846], [-78.9112, 73.8144], [-76.7017, 73.7603],...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>application/octet-stream</td>
      <td>9518f48d-0120-59df-b0e7-a1d87170f076</td>
      <td>S3A_OL_1_EFR____20180601T151719_20180601T152019_20180602T202543_0179_032_011_1800_LN1_O_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2018-11-01T18:21:37.387000Z</td>
      <td>2018-06-02T23:55:26.408000Z</td>
      <td>2018-06-02T23:55:26.408000Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/01/S3A_OL_1_EFR____20180601T151719_20180601T152019_2018...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-01T15:17:19.387665Z', 'End': '2018-06-01T15:20:19.387665Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-82.4652 63.4066, -81.0948 63.3611, -79.7204 63.3025, -78.347 63.2...</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-82.4652, 63.4066], [-81.0948, 63.3611], [-79.7204, 63.302...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>application/octet-stream</td>
      <td>5ca7a0cc-29eb-50dd-bf25-cb2353052615</td>
      <td>S3B_OL_1_EFR____20180601T165425_20180601T165725_20200126T011547_0180_008_012_1620_MR1_R_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2020-05-04T14:56:38.609000Z</td>
      <td>2020-05-04T16:04:34.446099Z</td>
      <td>2020-05-04T16:04:34.446099Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/01/S3B_OL_1_EFR____20180601T165425_20180601T165725_2020...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-01T16:54:24.657000Z', 'End': '2018-06-01T16:57:24.657000Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-106.245 73.3703, -104.123 73.3434, -101.961 73.2887, -99.8418 73....</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-106.245, 73.3703], [-104.123, 73.3434], [-101.961, 73.288...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>20</th>
      <td>application/octet-stream</td>
      <td>4e3945b4-24b6-5f03-9b2f-b1fb26ccc767</td>
      <td>S3B_OL_1_EFR____20180602T180920_20180602T181220_20200126T012653_0180_008_027_1620_MR1_R_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2020-05-04T14:41:10.247000Z</td>
      <td>2020-05-04T16:11:06.378588Z</td>
      <td>2020-05-04T16:11:06.378588Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/02/S3B_OL_1_EFR____20180602T180920_20180602T181220_2020...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-02T18:09:19.936000Z', 'End': '2018-06-02T18:12:19.936000Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-124.97 73.369, -122.838 73.3418, -120.7 73.2876, -118.56 73.2109,...</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-124.97, 73.369], [-122.838, 73.3418], [-120.7, 73.2876], ...</td>
    </tr>
    <tr>
      <th>21</th>
      <td>application/octet-stream</td>
      <td>cdf0d9f9-0161-5ddb-90ca-93f47b7517f5</td>
      <td>S3B_OL_1_EFR____20180602T163120_20180602T163420_20200126T012628_0179_008_026_1800_MR1_R_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2020-05-04T15:01:10.174000Z</td>
      <td>2020-05-04T16:12:38.769235Z</td>
      <td>2020-05-04T16:12:38.769235Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/02/S3B_OL_1_EFR____20180602T163120_20180602T163420_2020...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-02T16:31:20.167000Z', 'End': '2018-06-02T16:34:20.167000Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-101.102 62.9284, -99.763 62.8877, -98.4059 62.8282, -97.0685 62.7...</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-101.102, 62.9284], [-99.763, 62.8877], [-98.4059, 62.8282...</td>
    </tr>
    <tr>
      <th>22</th>
      <td>application/octet-stream</td>
      <td>0300620e-0b0b-5bca-9c74-f761b91ce33d</td>
      <td>S3B_OL_1_EFR____20180602T162820_20180602T163120_20200126T012622_0179_008_026_1620_MR1_R_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2020-05-04T15:04:38.089000Z</td>
      <td>2020-05-04T16:12:39.413863Z</td>
      <td>2020-05-04T16:12:39.413863Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/02/S3B_OL_1_EFR____20180602T162820_20180602T163120_2020...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-02T16:28:20.167000Z', 'End': '2018-06-02T16:31:20.167000Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-99.7267 73.3692, -97.6048 73.3423, -95.4369 73.2875, -93.3143 73....</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-99.7267, 73.3692], [-97.6048, 73.3423], [-95.4369, 73.287...</td>
    </tr>
    <tr>
      <th>23</th>
      <td>application/octet-stream</td>
      <td>757400a9-0a28-523a-aa21-62b3d5da6c43</td>
      <td>S3A_OL_1_EFR____20180602T011332_20180602T011415_20180603T062858_0043_032_017_1080_LN1_O_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2018-11-01T18:26:26.980000Z</td>
      <td>2018-06-03T08:19:11.370000Z</td>
      <td>2018-06-03T08:19:11.370000Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/02/S3A_OL_1_EFR____20180602T011332_20180602T011415_2018...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-02T01:13:31.651927Z', 'End': '2018-06-02T01:14:14.712487Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-46.7631 74.8796, -49.2562 74.8483, -51.5857 74.7934, -53.8789 74....</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-46.7631, 74.8796], [-49.2562, 74.8483], [-51.5857, 74.793...</td>
    </tr>
    <tr>
      <th>24</th>
      <td>application/octet-stream</td>
      <td>a1c9e44e-dcac-5c66-b62e-527b383fff45</td>
      <td>S3A_OL_1_EFR____20180602T181007_20180602T181307_20180603T230737_0179_032_027_1620_LN1_O_NT_002.SEN3</td>
      <td>application/octet-stream</td>
      <td>0</td>
      <td>2018-10-28T21:46:42.233000Z</td>
      <td>2018-06-04T00:31:59.555000Z</td>
      <td>2018-06-04T00:31:59.555000Z</td>
      <td>True</td>
      <td>9999-12-31T23:59:59.999999Z</td>
      <td>/eodata/Sentinel-3/OLCI/OL_1_EFR/2018/06/02/S3A_OL_1_EFR____20180602T181007_20180602T181307_2018...</td>
      <td>[]</td>
      <td>{'Start': '2018-06-02T18:10:06.920439Z', 'End': '2018-06-02T18:13:06.920439Z'}</td>
      <td>geography'SRID=4326;POLYGON ((-125.067 73.8593, -122.83 73.8272, -120.625 73.7729, -118.435 73.6...</td>
      <td>{'type': 'Polygon', 'coordinates': [[[-125.067, 73.8593], [-122.83, 73.8272], [-120.625, 73.7729...</td>
    </tr>
  </tbody>
</table>
<p>25 rows Ã— 15 columns</p>
</div></div></div>
</div>
</section>
<section id="step-4-download">
<h3>Step 4: Download<a class="headerlink" href="#step-4-download" title="Permalink to this heading">#</a></h3>
<p>Once you have the correct filename in the Copernicus format, the final step is to download the data. This process involves authenticating with your Copernicus dataspace credentials and sending a request to download the specified file. Below is an example code snippet demonstrating how to perform the download. Ensure that your username and password are accurate and up-to-date to avoid any authentication issues.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;your_username&quot;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;your_password&quot;</span>
<span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Replace with your desired download directory</span>
<span class="n">product_id</span> <span class="o">=</span> <span class="n">sentinel3_olci_data</span><span class="p">[</span><span class="s1">&#39;Id&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Replace with your desired file id</span>
<span class="n">file_name</span> <span class="o">=</span> <span class="n">sentinel3_olci_data</span><span class="p">[</span><span class="s1">&#39;Name&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="c1"># Replace with your desired filename</span>
<span class="c1"># Download the single product</span>
<span class="n">download_single_product</span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Until here, you should have the dataset downloaded in the directory you specified.</p>
</section>
<section id="another-downloading-option-download-directly-from-one-file-with-know-filename-you-are-interested-in">
<h3>Another downloading option: Download directly from one file (with know filename) you are interested in<a class="headerlink" href="#another-downloading-option-download-directly-from-one-file-with-know-filename-you-are-interested-in" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">query_product_by_name</span><span class="p">(</span><span class="n">product_name</span><span class="p">,</span> <span class="n">token</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Query a specific Sentinel-3 product by its name.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    product_name (str): The exact name of the product to search for.</span>
<span class="sd">    token (str): Access token for authentication.</span>

<span class="sd">    Returns:</span>
<span class="sd">    dict: Metadata for the matching product.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">url</span> <span class="o">=</span> <span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;https://catalogue.dataspace.copernicus.eu/odata/v1/Products?&quot;</span>
        <span class="sa">f</span><span class="s2">&quot;$filter=Name eq &#39;</span><span class="si">{</span><span class="n">product_name</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="p">)</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">}</span>
    
    <span class="n">response</span> <span class="o">=</span> <span class="n">make_api_request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;value&quot;</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Return the first matching product (if any)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No product found with name: </span><span class="si">{</span><span class="n">product_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error fetching product: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">status_code</span><span class="si">}</span><span class="s2"> - </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">text</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>



<span class="n">username</span> <span class="o">=</span> <span class="s2">&quot;your_username&quot;</span>
<span class="n">password</span> <span class="o">=</span> <span class="s2">&quot;your_password&quot;</span>

<span class="c1"># Step 1: Authenticate and retrieve tokens</span>
<span class="n">access_token</span><span class="p">,</span> <span class="n">refresh_token</span> <span class="o">=</span> <span class="n">get_access_and_refresh_token</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>

<span class="c1"># Step 2: Provide the product name</span>
<span class="n">product_name</span> <span class="o">=</span> <span class="s2">&quot;S3A_OL_1_EFR____20180602T181007_20180602T181307_20180603T230737_0179_032_027_1620_LN1_O_NT_002.SEN3&quot;</span>  <span class="c1"># Replace with the specific product name you have</span>

<span class="c1"># Step 3: Query the product by name</span>
<span class="n">product_metadata</span> <span class="o">=</span> <span class="n">query_product_by_name</span><span class="p">(</span><span class="n">product_name</span><span class="p">,</span> <span class="n">access_token</span><span class="p">)</span>

<span class="k">if</span> <span class="n">product_metadata</span><span class="p">:</span>
    <span class="n">product_id</span> <span class="o">=</span> <span class="n">product_metadata</span><span class="p">[</span><span class="s2">&quot;Id&quot;</span><span class="p">]</span>  <span class="c1"># Extract product ID from metadata</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">product_metadata</span><span class="p">[</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span>  <span class="c1"># Extract product name from metadata</span>

    <span class="c1"># Step 4: Download the product</span>
    <span class="n">download_dir</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>  <span class="c1"># Replace with your desired directory</span>
    <span class="n">download_single_product</span><span class="p">(</span><span class="n">product_id</span><span class="p">,</span> <span class="n">file_name</span><span class="p">,</span> <span class="n">access_token</span><span class="p">,</span> <span class="n">download_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloaded: /Users/weibinchen/Downloads/S3A_OL_1_EFR____20180602T181007_20180602T181307_20180603T230737_0179_032_027_1620_LN1_O_NT_002.SEN3.zip
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Chapter_1_AI_Algorithms.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">AI/Machine Learning Implementation</p>
      </div>
    </a>
    <a class="right-next"
       href="Chapter_1_rollout_3.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Roll-out on a Full Image</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#copernicus-data-space">Copernicus Data Space</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#set-up-accounts">Set up Accounts</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-fetching-logic">Data Fetching Logic</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-0-set-up">Step 0: Set Up</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-read-in-functions-needed">Step 1: Read in Functions Needed</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-extract-metadata-from-copernicus-dataspace">Step 2: Extract Metadata from Copernicus Dataspace</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-4-download">Step 4: Download</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#another-downloading-option-download-directly-from-one-file-with-know-filename-you-are-interested-in">Another downloading option: Download directly from one file (with know filename) you are interested in</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michel Tsamados/Weibin Chen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      Â© Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>