

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Creating Training Data from Sentinel-2 and Sentinel-3 OLCI Data &#8212; GEOL0069 Guide Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'Creating_training_data_fromS3_S2-2';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Application of Regression Techniques in Satellite Imagery Analysis" href="Chapter1_Regression_Part2_2425.html" />
    <link rel="prev" title="Regression Techniques for Predictive Analysis" href="Chapter1_Regression.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
    
    
      
    
    
    <img src="_static/logo.png" class="logo__image only-light" alt="Logo image"/>
    <script>document.write(`<img src="_static/logo.png" class="logo__image only-dark" alt="Logo image"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Welcome to GEOL0069 AI for Earth Observation
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 1</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3APreparation.html">Preparation</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3AIRIS.html">Introduction to Intelligently Reinforced Image Segmentation (IRIS)</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 2</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3AML.html">Introduction to AI/Machine Learning</a></li>

<li class="toctree-l1"><a class="reference internal" href="Chapter_1_Sea_ice_and_Lead_Classification.html">Sea-ice and Lead Classification</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_1_AI_Algorithms.html">AI/Machine Learning Implementation</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 3</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter%201%3AFetching_Data.html">Data Fetching</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_1_rollout_3.html">Roll-out on a Full Image</a></li>





</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 4</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Data_Colocating_S2_S3_3.html">Colocating Sentinel-3 OLCI/SRAL and Sentinal-2 Optical Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Unsupervised_Learning_Methods_2.html">Unsupervised Learning</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 5</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Regression.html">Regression Techniques for Predictive Analysis</a></li>

<li class="toctree-l1 current active"><a class="current reference internal" href="#">Creating Training Data from Sentinel-2 and Sentinel-3 OLCI Data</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter1_Regression_Part2_2425.html">Application of Regression Techniques in Satellite Imagery Analysis</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 6</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Imagery_alignment_intro.html">Imagery Alignment: Introduction and Simple Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="Imagery_alignment_application.html">Images alignment on S3/S2</a></li>
<li class="toctree-l1"><a class="reference internal" href="Creating_training_data_from_aligned_misaligned_imagery.html">Creating Training Data from Aligned and Misaligned Imagery</a></li>
<li class="toctree-l1"><a class="reference internal" href="Regression_Application_MPF_aligned_misaligned_training_data.html">Regression Application on Melt Pond Fractions (MPF)</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 7</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter2_IntrotoGaussianProcesses.html">Introduction to Gaussian Processes</a></li>
<li class="toctree-l1"><a class="reference internal" href="Chapter_2_Intro_to_GPSat.html">Introduction to GPSat</a></li>




</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 8</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="Chapter_2_GPSat_along_track-3.html">GPSat Along-Track Interpolation</a></li>




<li class="toctree-l1"><a class="reference internal" href="Chapter_2_SLA_GPSat_William.html">Interpolation of Sea Level Anomaly using GPSat</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Week 9</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ExplainableAI.html">Explainable AI</a></li>
<li class="toctree-l1"><a class="reference internal" href="ExplainableAI_Part2.html">Explainable AI Part 2</a></li>


</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/executablebooks/jupyter-book/issues/new?title=Issue%20on%20page%20%2FCreating_training_data_fromS3_S2-2.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/Creating_training_data_fromS3_S2-2.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Creating Training Data from Sentinel-2 and Sentinel-3 OLCI Data</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-0-importing-sentinel-2-and-sentinel-3-olci-data">Step 0: Importing Sentinel-2 and Sentinel-3 OLCI Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-loading-data-needed">Step 1: Loading data needed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-label-s2-pixels-see-week-4-on-unsupervised-classification">Step 2: Label S2 pixels (See week 4 on unsupervised classification)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-find-collocated-pixels-using-kdtree">Step 3: Find collocated pixels using KDTree</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="creating-training-data-from-sentinel-2-and-sentinel-3-olci-data">
<h1>Creating Training Data from Sentinel-2 and Sentinel-3 OLCI Data<a class="headerlink" href="#creating-training-data-from-sentinel-2-and-sentinel-3-olci-data" title="Permalink to this heading">#</a></h1>
<p>In our previous session, we explored the method of retrieving colocated Sentinel-2 optical data alongside Sentinel-3 OLCI data. Building upon that foundation, this week’s focus shifts towards the processing these datasets into a ML dataset we can use for regression. Our ultimate goal is to achieve pixel-level colocation between the datasets, and the application of regression techniques in task of predicitng sea ice concentration from S3/S2.</p>
<section id="step-0-importing-sentinel-2-and-sentinel-3-olci-data">
<h2>Step 0: Importing Sentinel-2 and Sentinel-3 OLCI Data<a class="headerlink" href="#step-0-importing-sentinel-2-and-sentinel-3-olci-data" title="Permalink to this heading">#</a></h2>
<p>Now, we reintroduce some previously utilised code with a pivotal objective: to import raw data and transform it into a format amenable to our analysis requirements. Given the extensive memory demands of this operation, we recommend a conceptual understanding of the process rather than direct execution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>! pip install rasterio
! pip install netCDF4
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting rasterio
  Downloading rasterio-1.4.3-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (9.1 kB)
Collecting affine (from rasterio)
  Downloading affine-2.4.0-py3-none-any.whl.metadata (4.0 kB)
Requirement already satisfied: attrs in /usr/local/lib/python3.11/dist-packages (from rasterio) (25.1.0)
Requirement already satisfied: certifi in /usr/local/lib/python3.11/dist-packages (from rasterio) (2025.1.31)
Requirement already satisfied: click&gt;=4.0 in /usr/local/lib/python3.11/dist-packages (from rasterio) (8.1.8)
Collecting cligj&gt;=0.5 (from rasterio)
  Downloading cligj-0.7.2-py3-none-any.whl.metadata (5.0 kB)
Requirement already satisfied: numpy&gt;=1.24 in /usr/local/lib/python3.11/dist-packages (from rasterio) (1.26.4)
Collecting click-plugins (from rasterio)
  Downloading click_plugins-1.1.1-py2.py3-none-any.whl.metadata (6.4 kB)
Requirement already satisfied: pyparsing in /usr/local/lib/python3.11/dist-packages (from rasterio) (3.2.1)
Downloading rasterio-1.4.3-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (22.2 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">22.2/22.2 MB</span> <span class=" -Color -Color-Red">87.3 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading cligj-0.7.2-py3-none-any.whl (7.1 kB)
Downloading affine-2.4.0-py3-none-any.whl (15 kB)
Downloading click_plugins-1.1.1-py2.py3-none-any.whl (7.5 kB)
Installing collected packages: cligj, click-plugins, affine, rasterio
Successfully installed affine-2.4.0 click-plugins-1.1.1 cligj-0.7.2 rasterio-1.4.3
Collecting netCDF4
  Downloading netCDF4-1.7.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (1.8 kB)
Collecting cftime (from netCDF4)
  Downloading cftime-1.6.4.post1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (8.7 kB)
Requirement already satisfied: certifi in /usr/local/lib/python3.11/dist-packages (from netCDF4) (2025.1.31)
Requirement already satisfied: numpy in /usr/local/lib/python3.11/dist-packages (from netCDF4) (1.26.4)
Downloading netCDF4-1.7.2-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (9.3 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">9.3/9.3 MB</span> <span class=" -Color -Color-Red">85.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading cftime-1.6.4.post1-cp311-cp311-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (1.4 MB)
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">1.4/1.4 MB</span> <span class=" -Color -Color-Red">72.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hInstalling collected packages: cftime, netCDF4
Successfully installed cftime-1.6.4.post1 netCDF4-1.7.2
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">google.colab</span> <span class="kn">import</span> <span class="n">drive</span>
<span class="n">drive</span><span class="o">.</span><span class="n">mount</span><span class="p">(</span><span class="s1">&#39;/content/drive&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Mounted at /content/drive
</pre></div>
</div>
</div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="c1">#This takes ~60 seconds and ~2Gb RAM</span>

<span class="kn">import</span> <span class="nn">rasterio</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.mixture</span> <span class="kn">import</span> <span class="n">GaussianMixture</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Proj</span><span class="p">,</span> <span class="n">transform</span>

<span class="c1"># Paths to the band images</span>
<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/GEOL0069/2425/Week 5/&#39;</span> <span class="c1"># You need to specify the path</span>
<span class="n">base_path</span> <span class="o">=</span> <span class="s2">&quot;S2A_MSIL1C_20190301T235611_N0207_R116_T01WCU_20190302T014622.SAFE/GRANULE/L1C_T01WCU_A019275_20190301T235610/IMG_DATA/&quot;</span>
<span class="n">bands_paths</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;B4&#39;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="n">base_path</span> <span class="o">+</span> <span class="s1">&#39;T01WCU_20190301T235611_B04.jp2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;B3&#39;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="n">base_path</span> <span class="o">+</span> <span class="s1">&#39;T01WCU_20190301T235611_B03.jp2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;B2&#39;</span><span class="p">:</span> <span class="n">path</span> <span class="o">+</span> <span class="n">base_path</span> <span class="o">+</span> <span class="s1">&#39;T01WCU_20190301T235611_B02.jp2&#39;</span>
<span class="p">}</span>

<span class="c1"># Read and stack the band images</span>
<span class="n">band_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">band</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;B4&#39;</span><span class="p">,</span> <span class="s1">&#39;B3&#39;</span><span class="p">,</span> <span class="s1">&#39;B2&#39;</span><span class="p">]:</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">bands_paths</span><span class="p">[</span><span class="n">band</span><span class="p">])</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">band_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>

<span class="c1"># Stack bands and create a mask for valid data (non-zero values in all bands)</span>
<span class="n">band_stack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span><span class="p">(</span><span class="n">band_data</span><span class="p">)</span>
<span class="n">valid_data_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">band_stack</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Reshape for GMM, only including valid data</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">band_stack</span><span class="p">[</span><span class="n">valid_data_mask</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>

<span class="n">s2_filename</span> <span class="o">=</span> <span class="n">path</span> <span class="o">+</span> <span class="s1">&#39;./S2A_MSIL1C_20190301T235611_N0207_R116_T01WCU_20190302T014622.SAFE/GRANULE/L1C_T01WCU_A019275_20190301T235610/IMG_DATA/T01WCU_20190301T235611_B04.jp2&#39;</span>

<span class="c1"># Read the Sentinel-2 image and its geospatial information</span>
<span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">s2_filename</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
    <span class="c1"># Read the raster data and the affine transformation</span>
    <span class="n">s2_data</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">transform_matrix</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">transform</span>

    <span class="c1"># Get the spatial reference system (CRS)</span>
    <span class="n">srs</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span>

<span class="c1"># Create grid of X,Y values</span>
<span class="n">rows</span><span class="p">,</span> <span class="n">cols</span> <span class="o">=</span> <span class="n">s2_data</span><span class="o">.</span><span class="n">shape</span>
<span class="n">x_s2</span><span class="p">,</span> <span class="n">y_s2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">rows</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">cols</span><span class="p">):</span>
        <span class="n">x</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">transform_matrix</span> <span class="o">*</span> <span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">row</span><span class="p">)</span>
        <span class="n">x_s2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">y_s2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Convert grid of X,Y values to latitude/longitude</span>
<span class="n">in_proj</span> <span class="o">=</span> <span class="n">Proj</span><span class="p">(</span><span class="n">init</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">srs</span><span class="p">))</span>  <span class="c1"># Initialize projection from CRS</span>
<span class="n">out_proj</span> <span class="o">=</span> <span class="n">Proj</span><span class="p">(</span><span class="n">proj</span><span class="o">=</span><span class="s1">&#39;latlong&#39;</span><span class="p">)</span>  <span class="c1"># Initialize projection for latitude/longitude</span>

</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">griddata</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">pyproj</span> <span class="kn">import</span> <span class="n">Proj</span><span class="p">,</span> <span class="n">transform</span>

<span class="c1"># Define the path to the main folder where your data is stored.</span>
<span class="c1"># You need to replace &#39;path/to/data&#39; with the actual path to your data folder.</span>
<span class="n">main_folder_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/GEOL0069/2425/Week 5&#39;</span>
<span class="c1"># main_folder_path = &#39;./&#39;</span>
<span class="c1"># This part of the code is responsible for finding all directories in the main_folder that end with &#39;.SEN3&#39;.</span>
<span class="c1"># &#39;.SEN3&#39; is the format of the folder containing specific satellite data files (in this case, OLCI data files).</span>
<span class="n">directories</span> <span class="o">=</span> <span class="p">[</span><span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">main_folder_path</span><span class="p">)</span> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_folder_path</span><span class="p">,</span> <span class="n">d</span><span class="p">))</span> <span class="ow">and</span> <span class="n">d</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;002.SEN3&#39;</span><span class="p">)]</span> <span class="c1">#load OLCI imagery</span>

<span class="c1"># Loop over each directory (i.e., each set of data) found above.</span>
<span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">directories</span><span class="p">:</span>
    <span class="c1"># Construct the path to the OLCI data file within the directory.</span>
    <span class="c1"># This path is used to access the data files.</span>
    <span class="n">OLCI_file_p</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">main_folder_path</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>

    <span class="c1"># Print the path to the current data file being processed.</span>
    <span class="c1"># This is helpful for tracking which file is being processed at any time.</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing: </span><span class="si">{</span><span class="n">OLCI_file_p</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Load the instrument data from a file named &#39;instrument_data.nc&#39; inside the directory.</span>
    <span class="c1"># This file contains various data about the instrument that captured the satellite data.</span>
    <span class="n">instrument_data</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">OLCI_file_p</span> <span class="o">+</span> <span class="s1">&#39;/instrument_data.nc&#39;</span><span class="p">)</span>
    <span class="n">solar_flux</span> <span class="o">=</span> <span class="n">instrument_data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;solar_flux&#39;</span><span class="p">][:]</span>  <span class="c1"># Extract the solar flux data.</span>
    <span class="n">detector_index</span> <span class="o">=</span> <span class="n">instrument_data</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;detector_index&#39;</span><span class="p">][:]</span>  <span class="c1"># Extract the detector index.</span>

    <span class="c1"># Load tie geometries from a file named &#39;tie_geometries.nc&#39;.</span>
    <span class="c1"># Tie geometries contain information about viewing angles, which are important for data analysis.</span>
    <span class="n">tie_geometries</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">OLCI_file_p</span> <span class="o">+</span> <span class="s1">&#39;/tie_geometries.nc&#39;</span><span class="p">)</span>
    <span class="n">SZA</span> <span class="o">=</span> <span class="n">tie_geometries</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;SZA&#39;</span><span class="p">][:]</span>  <span class="c1"># Extract the Solar Zenith Angle (SZA).</span>

    <span class="c1"># Create a directory for saving the processed data using the original directory name.</span>
    <span class="c1"># This directory will be used to store output files.</span>
    <span class="n">save_directory</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;path/to/save&#39;</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">save_directory</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">save_directory</span><span class="p">)</span>

    <span class="c1"># This loop processes each radiance band in the OLCI data.</span>
    <span class="c1"># OLCI instruments capture multiple bands, each representing different wavelengths.</span>
    <span class="n">OLCI_data</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">Radiance</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">22</span><span class="p">):</span>  <span class="c1"># There are 21 bands in OLCI data.</span>
    <span class="c1"># for Radiance in [2,5,8,16]:  # selecting relevant bands</span>

        <span class="n">Rstr</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%02d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Radiance</span>  <span class="c1"># Formatting the band number.</span>
        <span class="n">solar_flux_band</span> <span class="o">=</span> <span class="n">solar_flux</span><span class="p">[</span><span class="n">Radiance</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Get the solar flux for the current band.</span>

        <span class="c1"># Print information about the current band being processed.</span>
        <span class="c1"># This includes the band number and its corresponding solar flux.</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Processing Band: </span><span class="si">{</span><span class="n">Rstr</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Solar Flux for Band </span><span class="si">{</span><span class="n">Rstr</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">solar_flux_band</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Load radiance values from the OLCI data file for the current band.</span>
        <span class="n">OLCI_nc</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">OLCI_file_p</span> <span class="o">+</span> <span class="s1">&#39;/Oa&#39;</span> <span class="o">+</span> <span class="n">Rstr</span> <span class="o">+</span> <span class="s1">&#39;_radiance.nc&#39;</span><span class="p">)</span>
        <span class="n">radiance_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">OLCI_nc</span><span class="p">[</span><span class="s1">&#39;Oa&#39;</span> <span class="o">+</span> <span class="n">Rstr</span> <span class="o">+</span> <span class="s1">&#39;_radiance&#39;</span><span class="p">])</span>

        <span class="c1"># Initialize an array to store angle data, which will be calculated based on SZA.</span>
        <span class="n">angle</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">radiance_values</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">angle</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">angle</span><span class="p">[:,</span> <span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">SZA</span><span class="p">[:,</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">/</span><span class="mi">64</span><span class="p">)]</span>

        <span class="c1"># Calculate the Top of Atmosphere Bidirectional Reflectance Factor (TOA BRF) for the current band.</span>
        <span class="n">TOA_BRF</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">radiance_values</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">solar_flux_band</span><span class="p">[</span><span class="n">detector_index</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">angle</span><span class="p">)))</span>

        <span class="c1"># Add the calculated TOA BRF data to the OLCI_data list.</span>
        <span class="n">OLCI_data</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TOA_BRF</span><span class="p">)</span>

    <span class="n">reshaped_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">OLCI_data</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">OLCI_coord</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">OLCI_file_p</span> <span class="o">+</span> <span class="s1">&#39;/geo_coordinates.nc&#39;</span><span class="p">)</span>
    <span class="n">OLCI_lon</span><span class="o">=</span><span class="n">OLCI_coord</span><span class="p">[</span><span class="s1">&#39;longitude&#39;</span><span class="p">]</span>
    <span class="n">OLCI_lat</span><span class="o">=</span><span class="n">OLCI_coord</span><span class="p">[</span><span class="s1">&#39;latitude&#39;</span><span class="p">]</span>

<span class="n">x_s3</span><span class="p">,</span> <span class="n">y_s3</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">out_proj</span><span class="p">,</span> <span class="n">in_proj</span><span class="p">,</span> <span class="n">OLCI_lon</span><span class="p">,</span> <span class="n">OLCI_lat</span><span class="p">)</span>

</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This takes 10 minutes to run so we may not run this</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>


<span class="c1"># Reshape S2 Coordinates</span>
<span class="n">rows_s2</span><span class="p">,</span> <span class="n">cols_s2</span> <span class="o">=</span> <span class="n">s2_data</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># S2 resolution (e.g., 10980 x 10980)</span>
<span class="n">x_s2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_s2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows_s2</span><span class="p">,</span> <span class="n">cols_s2</span><span class="p">)</span>
<span class="n">y_s2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_s2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows_s2</span><span class="p">,</span> <span class="n">cols_s2</span><span class="p">)</span>

<span class="n">x_s3_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_s3</span><span class="p">)</span>
<span class="n">y_s3_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_s3</span><span class="p">)</span>


<span class="c1"># Compute the Extents</span>
<span class="c1"># S2 extents</span>
<span class="n">s2_x_min</span><span class="p">,</span> <span class="n">s2_x_max</span> <span class="o">=</span> <span class="n">x_s2_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_s2_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">s2_y_min</span><span class="p">,</span> <span class="n">s2_y_max</span> <span class="o">=</span> <span class="n">y_s2_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_s2_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># S3 extents</span>
<span class="n">s3_x_min</span><span class="p">,</span> <span class="n">s3_x_max</span> <span class="o">=</span> <span class="n">x_s3_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_s3_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">s3_y_min</span><span class="p">,</span> <span class="n">s3_y_max</span> <span class="o">=</span> <span class="n">y_s3_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_s3_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;S2 Extents:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   x: &quot;</span><span class="p">,</span> <span class="n">s2_x_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s2_x_max</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   y: &quot;</span><span class="p">,</span> <span class="n">s2_y_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s2_y_max</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">S3 Extents:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   x: &quot;</span><span class="p">,</span> <span class="n">s3_x_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s3_x_max</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   y: &quot;</span><span class="p">,</span> <span class="n">s3_y_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s3_y_max</span><span class="p">)</span>


<span class="c1"># Compute the Intersection (Overlapping Area)</span>

<span class="n">overlap_x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">s2_x_min</span><span class="p">,</span> <span class="n">s3_x_min</span><span class="p">)</span>
<span class="n">overlap_x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">s2_x_max</span><span class="p">,</span> <span class="n">s3_x_max</span><span class="p">)</span>
<span class="n">overlap_y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">s2_y_min</span><span class="p">,</span> <span class="n">s3_y_min</span><span class="p">)</span>
<span class="n">overlap_y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">s2_y_max</span><span class="p">,</span> <span class="n">s3_y_max</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Overlap Region Extents:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   x: &quot;</span><span class="p">,</span> <span class="n">overlap_x_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">overlap_x_max</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   y: &quot;</span><span class="p">,</span> <span class="n">overlap_y_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">overlap_y_max</span><span class="p">)</span>


<span class="c1"># Create Conditions for Overlapping Pixels</span>

<span class="n">condition_s2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">x_s2_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_s2_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">y_s2_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_s2_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_y_max</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">condition_s3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">x_s3_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_s3_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">y_s3_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_s3_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_y_max</span><span class="p">)</span>
<span class="p">)</span>


<span class="c1"># Plot the Overlap Regions</span>
<span class="c1"># Plot for S3 (OLCI)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">scatter1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x_s3_arr</span><span class="p">[</span><span class="n">condition_s3</span><span class="p">],</span>
    <span class="n">y_s3_arr</span><span class="p">[</span><span class="n">condition_s3</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">reshaped_array</span><span class="p">[</span><span class="n">condition_s3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reflectance (Band 0)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;S3 Overlap Region with S2&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate&#39;</span><span class="p">)</span>

<span class="c1"># Add the red dotted rectangle for the zoomed region</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>  <span class="c1"># get the current axes</span>

<span class="n">zoom_x_min</span> <span class="o">=</span> <span class="mf">350000.0</span>
<span class="n">zoom_x_max</span> <span class="o">=</span> <span class="mf">390000.0</span>
<span class="n">zoom_y_min</span> <span class="o">=</span> <span class="mf">7790230.0</span>
<span class="n">zoom_y_max</span> <span class="o">=</span> <span class="mf">7820000.0</span>

<span class="c1"># Rectangle width and height</span>
<span class="n">rect_width</span> <span class="o">=</span> <span class="n">zoom_x_max</span> <span class="o">-</span> <span class="n">zoom_x_min</span>
<span class="n">rect_height</span> <span class="o">=</span> <span class="n">zoom_y_max</span> <span class="o">-</span> <span class="n">zoom_y_min</span>

<span class="c1"># Create a Rectangle patch in data coordinates</span>
<span class="n">rect</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
    <span class="p">(</span><span class="n">zoom_x_min</span><span class="p">,</span> <span class="n">zoom_y_min</span><span class="p">),</span>
    <span class="n">rect_width</span><span class="p">,</span>
    <span class="n">rect_height</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
<span class="p">)</span>

<span class="c1"># Add the patch to the Axes</span>
<span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;S3_overlap_region_with_zoom.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>



<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">scatter2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">x_s2_arr</span><span class="p">[</span><span class="n">condition_s2</span><span class="p">],</span>
    <span class="n">y_s2_arr</span><span class="p">[</span><span class="n">condition_s2</span><span class="p">],</span>
    <span class="n">c</span><span class="o">=</span><span class="n">band_stack</span><span class="p">[</span><span class="n">condition_s2</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
    <span class="n">vmin</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reflectance (B2/10000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;S2 Overlap Region&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate&#39;</span><span class="p">)</span>

<span class="c1"># Add the same rectangle for the S2 plot</span>
<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">rect2</span> <span class="o">=</span> <span class="n">patches</span><span class="o">.</span><span class="n">Rectangle</span><span class="p">(</span>
    <span class="p">(</span><span class="n">zoom_x_min</span><span class="p">,</span> <span class="n">zoom_y_min</span><span class="p">),</span>
    <span class="n">rect_width</span><span class="p">,</span>
    <span class="n">rect_height</span><span class="p">,</span>
    <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
    <span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span>
    <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span>
<span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">rect2</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;S2_overlap_region_with_zoom.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

</pre></div>
</div>
<p>The output of the above cell is shown below. These are 2 plots showing the co-located region in S3 and S2 format.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># No need to run this</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;/content/S2_overlap_region_with_zoom.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;/content/S3_overlap_region_with_zoom.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/e4783c570ae81a86000bdf9a65c877e6401f951f6b5b6879e04329a49018555f.png" src="_images/e4783c570ae81a86000bdf9a65c877e6401f951f6b5b6879e04329a49018555f.png" />
<img alt="_images/cc722f30d39905157d1affcd14a2e3aeb974327a4aa37825c81f9eea1750b35e.png" src="_images/cc722f30d39905157d1affcd14a2e3aeb974327a4aa37825c81f9eea1750b35e.png" />
</div>
</div>
<p>Now we select a subregion and our analysis will be based on that. We saved them into numpy arrays for further analysis. The cell below will save the subregion data in both S3 and S2 format.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/GEOL0069/2425/Week 5/Regression_application&#39;</span>
<span class="n">rows_s2</span><span class="p">,</span> <span class="n">cols_s2</span> <span class="o">=</span> <span class="n">s2_data</span><span class="o">.</span><span class="n">shape</span>
<span class="n">x_s2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_s2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows_s2</span><span class="p">,</span> <span class="n">cols_s2</span><span class="p">)</span>
<span class="n">y_s2_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_s2</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">rows_s2</span><span class="p">,</span> <span class="n">cols_s2</span><span class="p">)</span>

<span class="n">x_s3_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x_s3</span><span class="p">)</span>
<span class="n">y_s3_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">y_s3</span><span class="p">)</span>

<span class="n">s2_x_min</span><span class="p">,</span> <span class="n">s2_x_max</span> <span class="o">=</span> <span class="n">x_s2_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_s2_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">s2_y_min</span><span class="p">,</span> <span class="n">s2_y_max</span> <span class="o">=</span> <span class="n">y_s2_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_s2_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="c1"># S3 extents</span>
<span class="n">s3_x_min</span><span class="p">,</span> <span class="n">s3_x_max</span> <span class="o">=</span> <span class="n">x_s3_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">x_s3_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">s3_y_min</span><span class="p">,</span> <span class="n">s3_y_max</span> <span class="o">=</span> <span class="n">y_s3_arr</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">y_s3_arr</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;S2 Extents:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   x:&quot;</span><span class="p">,</span> <span class="n">s2_x_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s2_x_max</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   y:&quot;</span><span class="p">,</span> <span class="n">s2_y_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s2_y_max</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">S3 Extents:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   x:&quot;</span><span class="p">,</span> <span class="n">s3_x_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s3_x_max</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   y:&quot;</span><span class="p">,</span> <span class="n">s3_y_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s3_y_max</span><span class="p">)</span>

<span class="c1"># Compute the Intersection (Overlapping Area) from the original extents</span>
<span class="n">overlap_x_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">s2_x_min</span><span class="p">,</span> <span class="n">s3_x_min</span><span class="p">)</span>
<span class="n">overlap_x_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">s2_x_max</span><span class="p">,</span> <span class="n">s3_x_max</span><span class="p">)</span>
<span class="n">overlap_y_min</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">s2_y_min</span><span class="p">,</span> <span class="n">s3_y_min</span><span class="p">)</span>
<span class="n">overlap_y_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">s2_y_max</span><span class="p">,</span> <span class="n">s3_y_max</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Overlap Region Extents:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   x:&quot;</span><span class="p">,</span> <span class="n">overlap_x_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">overlap_x_max</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   y:&quot;</span><span class="p">,</span> <span class="n">overlap_y_min</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">overlap_y_max</span><span class="p">)</span>

<span class="n">condition_s2</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">x_s2_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_s2_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">y_s2_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_s2_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_y_max</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">condition_s3</span> <span class="o">=</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">x_s3_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_s3_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">y_s3_arr</span> <span class="o">&gt;=</span> <span class="n">overlap_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_s3_arr</span> <span class="o">&lt;=</span> <span class="n">overlap_y_max</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">zoom_x_min</span> <span class="o">=</span> <span class="mf">350000.0</span>
<span class="n">zoom_x_max</span> <span class="o">=</span> <span class="mf">390000.0</span>
<span class="n">zoom_y_min</span> <span class="o">=</span> <span class="mf">7790230.0</span>
<span class="n">zoom_y_max</span> <span class="o">=</span> <span class="mf">7820000.0</span>

<span class="n">condition_zoom_s2</span> <span class="o">=</span> <span class="n">condition_s2</span> <span class="o">&amp;</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">x_s2_arr</span> <span class="o">&gt;=</span> <span class="n">zoom_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_s2_arr</span> <span class="o">&lt;=</span> <span class="n">zoom_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">y_s2_arr</span> <span class="o">&gt;=</span> <span class="n">zoom_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_s2_arr</span> <span class="o">&lt;=</span> <span class="n">zoom_y_max</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">condition_zoom_s3</span> <span class="o">=</span> <span class="n">condition_s3</span> <span class="o">&amp;</span> <span class="p">(</span>
    <span class="p">(</span><span class="n">x_s3_arr</span> <span class="o">&gt;=</span> <span class="n">zoom_x_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">x_s3_arr</span> <span class="o">&lt;=</span> <span class="n">zoom_x_max</span><span class="p">)</span> <span class="o">&amp;</span>
    <span class="p">(</span><span class="n">y_s3_arr</span> <span class="o">&gt;=</span> <span class="n">zoom_y_min</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">y_s3_arr</span> <span class="o">&lt;=</span> <span class="n">zoom_y_max</span><span class="p">)</span>
<span class="p">)</span>


<span class="n">s2_zoom_x</span> <span class="o">=</span> <span class="n">x_s2_arr</span><span class="p">[</span><span class="n">condition_zoom_s2</span><span class="p">]</span>
<span class="n">s2_zoom_y</span> <span class="o">=</span> <span class="n">y_s2_arr</span><span class="p">[</span><span class="n">condition_zoom_s2</span><span class="p">]</span>
<span class="n">s2_zoom_data</span> <span class="o">=</span> <span class="n">band_stack</span><span class="p">[</span><span class="n">condition_zoom_s2</span><span class="p">,</span> <span class="p">:]</span>

<span class="c1"># For S3</span>
<span class="n">s3_zoom_x</span> <span class="o">=</span> <span class="n">x_s3_arr</span><span class="p">[</span><span class="n">condition_zoom_s3</span><span class="p">]</span>
<span class="n">s3_zoom_y</span> <span class="o">=</span> <span class="n">y_s3_arr</span><span class="p">[</span><span class="n">condition_zoom_s3</span><span class="p">]</span>
<span class="n">s3_zoom_data</span> <span class="o">=</span> <span class="n">reshaped_array</span><span class="p">[</span><span class="n">condition_zoom_s3</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="s1">&#39;/s2_zoomed_data.npz&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">s2_zoom_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">s2_zoom_y</span><span class="p">,</span> <span class="n">band_data</span><span class="o">=</span><span class="n">s2_zoom_data</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="s1">&#39;/s3_zoomed_data.npz&#39;</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="n">s3_zoom_x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">s3_zoom_y</span><span class="p">,</span> <span class="n">reflectance</span><span class="o">=</span><span class="n">s3_zoom_data</span><span class="p">)</span>


</pre></div>
</div>
</section>
<section id="step-1-loading-data-needed">
<h2>Step 1: Loading data needed<a class="headerlink" href="#step-1-loading-data-needed" title="Permalink to this heading">#</a></h2>
<p>We load the saved S2 and S3 data here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/GEOL0069/2425/Week 5/Regression_application&#39;</span>
<span class="n">s2_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="s1">&#39;/s2_zoomed_data.npz&#39;</span><span class="p">)</span>
<span class="n">s2_x</span> <span class="o">=</span> <span class="n">s2_data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="n">s2_y</span> <span class="o">=</span> <span class="n">s2_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="n">s2_band_data</span> <span class="o">=</span> <span class="n">s2_data</span><span class="p">[</span><span class="s1">&#39;band_data&#39;</span><span class="p">]</span>

<span class="n">s3_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="s1">&#39;/s3_zoomed_data.npz&#39;</span><span class="p">)</span>
<span class="n">s3_x</span> <span class="o">=</span> <span class="n">s3_data</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]</span>
<span class="n">s3_y</span> <span class="o">=</span> <span class="n">s3_data</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
<span class="n">s3_reflectance</span> <span class="o">=</span> <span class="n">s3_data</span><span class="p">[</span><span class="s1">&#39;reflectance&#39;</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">scatter_s2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">s2_x</span><span class="p">,</span> <span class="n">s2_y</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">s2_band_data</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter_s2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reflectance (B2/10000)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zoomed S2 Overlap Region&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>


<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">scatter_s3</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
    <span class="n">s3_x</span><span class="p">,</span> <span class="n">s3_y</span><span class="p">,</span>
    <span class="n">c</span><span class="o">=</span><span class="n">s3_reflectance</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span>
    <span class="n">s</span><span class="o">=</span><span class="mi">10</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter_s3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Reflectance (Band 0)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Zoomed S3 Overlap Region&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/cdaa52a6a0bb289f5985f9ec9c329bb9a0ce116a67f0c6879977cb680fa5d9d2.png" src="_images/cdaa52a6a0bb289f5985f9ec9c329bb9a0ce116a67f0c6879977cb680fa5d9d2.png" />
<img alt="_images/32736e2d31b365c41c3001eeddcd12660cc07060b98f27eb353c58ce1345363d.png" src="_images/32736e2d31b365c41c3001eeddcd12660cc07060b98f27eb353c58ce1345363d.png" />
</div>
</div>
</section>
<section id="step-2-label-s2-pixels-see-week-4-on-unsupervised-classification">
<h2>Step 2: Label S2 pixels (See week 4 on unsupervised classification)<a class="headerlink" href="#step-2-label-s2-pixels-see-week-4-on-unsupervised-classification" title="Permalink to this heading">#</a></h2>
<p>For the code below, we use K-Means clustering to get the labels of Sentinel-2 image and we will use them to generate part of the training data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">matplotlib.colors</span> <span class="kn">import</span> <span class="n">ListedColormap</span>

<span class="n">kmeans</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">fit_predict</span><span class="p">(</span><span class="n">s2_band_data</span><span class="p">)</span>

<span class="n">unique_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">s2_x</span><span class="p">))</span>
<span class="n">unique_y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">s2_y</span><span class="p">))</span>

<span class="n">num_cols</span> <span class="o">=</span> <span class="n">unique_x</span><span class="o">.</span><span class="n">size</span>
<span class="n">num_rows</span> <span class="o">=</span> <span class="n">unique_y</span><span class="o">.</span><span class="n">size</span>

<span class="n">N</span> <span class="o">=</span> <span class="n">s2_band_data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">binary_mask</span> <span class="o">=</span> <span class="n">labels</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">num_rows</span><span class="p">,</span> <span class="n">num_cols</span><span class="p">)</span>

<span class="k">if</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">kmeans</span><span class="o">.</span><span class="n">cluster_centers_</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">():</span>
    <span class="n">binary_mask</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">binary_mask</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">binary_cmap</span> <span class="o">=</span> <span class="n">ListedColormap</span><span class="p">([</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="s2">&quot;white&quot;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">binary_mask</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">binary_cmap</span><span class="p">,</span> <span class="n">origin</span><span class="o">=</span><span class="s1">&#39;upper&#39;</span><span class="p">,</span>
           <span class="n">extent</span><span class="o">=</span><span class="p">[</span><span class="n">unique_x</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">unique_x</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">unique_y</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">unique_y</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Class&quot;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clim</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Binary K-means Segmentation of Zoomed-in S2 Data&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;X Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Y Coordinate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/70ae981084752086d515a50e3098734b31c6eb667a758a30c3b5c28534127d39.png" src="_images/70ae981084752086d515a50e3098734b31c6eb667a758a30c3b5c28534127d39.png" />
</div>
</div>
</section>
<section id="step-3-find-collocated-pixels-using-kdtree">
<h2>Step 3: Find collocated pixels using KDTree<a class="headerlink" href="#step-3-find-collocated-pixels-using-kdtree" title="Permalink to this heading">#</a></h2>
<p>The code constructs a KDTree from S3 coordinates to quickly find the nearest S3 pixel for each S2 data point based on their (x, y) positions. It then groups S2 points by their nearest S3 neighbor and computes an aggregated value (sea ice concentration) for each S3 pixel. In the end, we create a dataset that we could use for ML activities.</p>
<p>The logic of our KDTree is for each Sentinel‑2 pixel to find its nearest Sentinel‑3 pixel, ensuring that every fine-resolution S2 measurement is uniquely assigned to a single coarse-resolution S3 pixel—this approach avoids the pitfalls of using a fixed radius around each S3 pixel, which could potentially miss some S2 pixels or count them more than once. A illustration is shown here.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># No need to run this</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">display</span>
<span class="n">display</span><span class="p">(</span><span class="n">Image</span><span class="p">(</span><span class="n">filename</span><span class="o">=</span><span class="s1">&#39;/content/S3S2KDtree.png&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/95eded8326725fe7ed1b01d23c1925b6a7ebea138a7c2606dbaf174c567e0d53.png" src="_images/95eded8326725fe7ed1b01d23c1925b6a7ebea138a7c2606dbaf174c567e0d53.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">KDTree</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>


<span class="n">s2_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">s2_x</span><span class="p">,</span> <span class="n">s2_y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">s3_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">s3_x</span><span class="p">,</span> <span class="n">s3_y</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>

<span class="n">tree</span> <span class="o">=</span> <span class="n">KDTree</span><span class="p">(</span><span class="n">s3_points</span><span class="p">)</span>

<span class="n">distances</span><span class="p">,</span> <span class="n">s3_indices_for_s2</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">s2_points</span><span class="p">)</span>

<span class="n">grouped</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s2_idx</span><span class="p">,</span> <span class="n">s3_idx</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">s3_indices_for_s2</span><span class="p">):</span>
    <span class="n">grouped</span><span class="p">[</span><span class="n">s3_idx</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s2_idx</span><span class="p">)</span>

<span class="n">SICavg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">s3_points</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s3_idx</span><span class="p">,</span> <span class="n">s2_indices</span> <span class="ow">in</span> <span class="n">grouped</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">SICavg</span><span class="p">[</span><span class="n">s3_idx</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">labels</span><span class="p">[</span><span class="n">s2_indices</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the distaces as a histogram</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">distances</span><span class="p">,</span> <span class="n">bins</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Distance (m)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;S2 to nearest S3 distance histogram&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;Mean distance: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> m&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b1449cdb39470c1205ea03639d6bb8883f57e377b32f11109e2f0393d47992ad.png" src="_images/b1449cdb39470c1205ea03639d6bb8883f57e377b32f11109e2f0393d47992ad.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">scatter</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">s3_points</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">s3_points</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span>
                      <span class="n">c</span><span class="o">=</span><span class="n">SICavg</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">scatter</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Sea Ice Concentration (SIC)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;S3 Points with Sea Ice Concentration Derived from Co-located S2&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;X Coordinate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Y Coordinate&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6cafd01e36232c9d1634e9325c0991041f1c04642bfc38a1f50a395a621423aa.png" src="_images/6cafd01e36232c9d1634e9325c0991041f1c04642bfc38a1f50a395a621423aa.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>


<span class="n">valid_mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">SICavg</span><span class="p">)</span>
<span class="n">X_valid</span> <span class="o">=</span> <span class="n">s3_reflectance</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">y_valid</span> <span class="o">=</span> <span class="n">SICavg</span><span class="p">[</span><span class="n">valid_mask</span><span class="p">]</span>

<span class="n">n_bands</span> <span class="o">=</span> <span class="n">s3_reflectance</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">column_names</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;refl_band_</span><span class="si">{</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_bands</span><span class="p">)]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">column_names</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;SIC&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_valid</span>
<span class="n">save_path</span> <span class="o">=</span> <span class="s1">&#39;/content/drive/MyDrive/GEOL0069/2425/Week 5/Regression_application&#39;</span>
<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="s1">&#39;/s3_ML_dataset.npz&#39;</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="n">X_valid</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y_valid</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">save_path</span><span class="o">+</span><span class="s1">&#39;/s3_ML_dataset.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;ML dataset created and saved!&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Feature shape:&quot;</span><span class="p">,</span> <span class="n">X_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Target shape:&quot;</span><span class="p">,</span> <span class="n">y_valid</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>ML dataset created and saved!
Feature shape: (14445, 21)
Target shape: (14445,)
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="Chapter1_Regression.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Regression Techniques for Predictive Analysis</p>
      </div>
    </a>
    <a class="right-next"
       href="Chapter1_Regression_Part2_2425.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Application of Regression Techniques in Satellite Imagery Analysis</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-0-importing-sentinel-2-and-sentinel-3-olci-data">Step 0: Importing Sentinel-2 and Sentinel-3 OLCI Data</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-1-loading-data-needed">Step 1: Loading data needed</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-2-label-s2-pixels-see-week-4-on-unsupervised-classification">Step 2: Label S2 pixels (See week 4 on unsupervised classification)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#step-3-find-collocated-pixels-using-kdtree">Step 3: Find collocated pixels using KDTree</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Michel Tsamados/Weibin Chen
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>